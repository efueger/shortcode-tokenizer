{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap dd5f327996176abc2c97","webpack:///./src/shortcode-tokenizer.js"],"names":["Token","type","body","pos","children","params","isClosed","SELF_CLOSING","CLOSE","name","substring","length","OPEN","match","rxOpen","rxSelfclosing","SyntaxError","token","TEXT","RX_KEY","RX_PARAM","RX_PARAMS","RX_ENCLOSURE","RX_OPEN","RX_SELFCLOSING","RX_CLOSE","rxEnclosure","RegExp","rxClose","ShortcodeTokenizer","buf","tokens","strict","input","Error","originalBuf","_token","Array","isArray","push","stack","ast","parent","shift","canClose","unshift","pop","index","_getNotTextType","str","Object","assign"],"mappings":"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","file":"shortcode-tokenizer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"shortcodeTokenizer\"] = factory();\n\telse\n\t\troot[\"shortcodeTokenizer\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap dd5f327996176abc2c97\n **/","export class Token {\n  constructor(type, body, pos = 0) {\n    this.type = type\n    this.body = body\n    this.pos = pos\n    this.children = []\n    this.params = []\n    this.isClosed = type === SELF_CLOSING\n\n    switch (this.type) {\n      case CLOSE:\n        this.name = this.body.substring(2, this.body.length - 1)\n        break\n      case OPEN:\n      case SELF_CLOSING:\n        let match = this.body.match(this.type === OPEN ? rxOpen : rxSelfclosing)\n        if (match === null) {\n          throw new SyntaxError('Invalid ' + this.type + ' token: ' + this.body)\n        }\n        this.name = match[1]\n        break\n      default:\n        break\n    }\n  }\n\n  canClose(token) {\n    return this.name === token.name\n  }\n}\n\nexport const TEXT = 'TEXT'\nexport const OPEN = 'OPEN'\nexport const CLOSE = 'CLOSE'\nexport const SELF_CLOSING = 'SELF_CLOSING'\n\n/* eslint-disable */\nconst RX_KEY = '[a-zA-Z0-9_]+'\n\nconst RX_PARAM = RX_KEY +                           // flags\n                 '|' + RX_KEY + '=\\\\d+\\\\.\\\\d+' +    // floats\n                 '|' + RX_KEY + '=\\\\d+' +           // ints\n                 '|' + RX_KEY + '=\"[^\\\\]\"]*\"' +     // double-qouted strings\n                 '|' + RX_KEY + '=\\'[^\\\\]\\']*\\''    // single-qouted strings\n\nconst RX_PARAMS = '(\\\\s((' + RX_PARAM + ')((?!\\\\s+/?\\\\])\\\\s|))+)?'\n\nconst RX_ENCLOSURE   = '\\\\[\\\\/?[a-zA-Z][^\\\\]]+\\\\]'\nconst RX_OPEN        = '\\\\[(' + RX_KEY + ')' + RX_PARAMS + '\\\\]'\nconst RX_SELFCLOSING = '\\\\[(' + RX_KEY + ')' + RX_PARAMS + '\\\\s?\\\\/\\\\]'\nconst RX_CLOSE       = '\\\\[\\\\/(' + RX_KEY + ')\\\\]'\n\nconst rxEnclosure   = new RegExp(RX_ENCLOSURE)\nconst rxOpen        = new RegExp(RX_OPEN, 'i')\nconst rxClose       = new RegExp(RX_CLOSE, 'i')\nconst rxSelfclosing = new RegExp(RX_SELFCLOSING, 'i')\n/* eslint-enable */\n\nexport default class ShortcodeTokenizer {\n\n  constructor() {\n    this.buf = null\n    this.pos = 0\n    this.tokens = []\n    this.strict = true\n  }\n\n  tokenize(input) {\n    if (typeof input !== 'string') {\n      throw new Error('Invalid input')\n    }\n\n    this.buf = this.originalBuf = input\n    this.pos = 0\n    this.tokens = []\n\n    // Get tokens\n    let token\n    while ((token = this._token()) !== null) {\n      if (Array.isArray(token)) {\n        this.tokens = [...this.tokens, ...token]\n      } else {\n        this.tokens.push(token)\n      }\n    }\n    return this\n  }\n\n  getTokens() {\n    return this.tokens\n  }\n\n  ast() {\n    let stack = []\n    let ast = []\n    let tokens = [...this.tokens]\n    let parent = null\n    let token\n    while ((token = tokens.shift())) {\n      if (token.type === TEXT) {\n        if (!parent) {\n          ast.push(token)\n        } else {\n          parent.children.push(token)\n        }\n      } else if (token.type === OPEN) {\n        if (parent === null) {\n          parent = token\n          ast.push(parent)\n        } else {\n          parent.children.push(token)\n          stack.push(parent)\n          parent = token\n        }\n      } else if (token.type === CLOSE) {\n        if (parent === null || !token.canClose(parent)) {\n          if (this.strict) {\n            throw new SyntaxError('Unmatched close token: ' + token.body)\n          } else {\n            // convert to text\n            tokens.unshift(new Token(TEXT, token.body))\n          }\n        } else {\n          parent.isClosed = true\n          parent = stack.pop()\n        }\n      } else if (token.type === SELF_CLOSING) {\n        ast.push(token)\n      } else {\n        throw new SyntaxError('Unknown token: ' + token.type)\n      }\n    }\n    return ast\n  }\n\n  _token() {\n    if (!this.buf) {\n      return null\n    }\n\n    let match = this.buf.match(rxEnclosure)\n\n    // all text\n    if (match === null) {\n      let token = new Token(TEXT, this.buf, this.pos)\n      this.pos += this.buf.length\n      this.buf = null\n      return token\n    }\n\n    let tokens = []\n\n    // first part is text\n    if (match.index !== 0) {\n      tokens.push(new Token(\n        TEXT,\n        this.buf.substring(0, match.index),\n        this.pos\n      ))\n    }\n\n    // matching token\n    tokens.push(new Token(\n      this._getNotTextType(match[0]),\n      match[0],\n      this.pos + match.index\n    ))\n\n    // shorten buffer\n    this.buf = this.buf.substring(match.index + match[0].length)\n    this.pos += match.index + match[0].length\n    if (this.buf.length === 0) {\n      this.buf = null\n    }\n    return tokens\n  }\n\n  _getNotTextType(str) {\n    if (str[1] === '/') {\n      return CLOSE\n    }\n    if (str[str.length - 2] === '/') {\n      return SELF_CLOSING\n    }\n    return OPEN\n  }\n}\n\nObject.assign(ShortcodeTokenizer, {\n  TEXT,\n  OPEN,\n  CLOSE,\n  SELF_CLOSING,\n  rxEnclosure,\n  rxOpen,\n  rxClose,\n  rxSelfclosing\n})\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/shortcode-tokenizer.js\n **/"],"sourceRoot":""}