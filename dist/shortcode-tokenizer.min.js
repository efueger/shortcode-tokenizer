!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.shortcodeTokenizer=e():t.shortcodeTokenizer=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=e.Token=function(){function t(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(i(this,t),this.type=e,this.body=n,this.pos=s,this.children=[],this.params=[],this.isClosed=e===l,this.type){case h:this.name=this.body.substring(2,this.body.length-1);break;case u:case l:var r=this.body.match(this.type===u?k:g);if(null===r)throw new SyntaxError("Invalid "+this.type+" token: "+this.body);this.name=r[1]}}return s(t,[{key:"canClose",value:function(t){return this.name===t.name}}]),t}(),o=e.TEXT="TEXT",u=e.OPEN="OPEN",h=e.CLOSE="CLOSE",l=e.SELF_CLOSING="SELF_CLOSING",a="[a-zA-Z0-9_]+",f=a+"|"+a+"=\\d+\\.\\d+|"+a+"=\\d+|"+a+'="[^\\]"]*"|'+a+"='[^\\]']*'",c="(\\s(("+f+")((?!\\s+/?\\])\\s|))+)?",p="\\[\\/?[a-zA-Z][^\\]]+\\]",d="\\[("+a+")"+c+"\\]",y="\\[("+a+")"+c+"\\s?\\/\\]",b="\\[\\/("+a+")\\]",x=new RegExp(p),k=new RegExp(d,"i"),v=new RegExp(b,"i"),g=new RegExp(y,"i"),E=function(){function t(){i(this,t),this.buf=null,this.pos=0,this.tokens=[],this.strict=!0}return s(t,[{key:"tokenize",value:function(t){if("string"!=typeof t)throw new Error("Invalid input");this.buf=this.originalBuf=t,this.pos=0,this.tokens=[];for(var e=void 0;null!==(e=this._token());)Array.isArray(e)?this.tokens=[].concat(n(this.tokens),n(e)):this.tokens.push(e);return this}},{key:"getTokens",value:function(){return this.tokens}},{key:"ast",value:function t(){for(var e=[],t=[],i=[].concat(n(this.tokens)),s=null,a=void 0;a=i.shift();)if(a.type===o)s?s.children.push(a):t.push(a);else if(a.type===u)null===s?(s=a,t.push(s)):(s.children.push(a),e.push(s),s=a);else if(a.type===h)if(null!==s&&a.canClose(s))s.isClosed=!0,s=e.pop();else{if(this.strict)throw new SyntaxError("Unmatched close token: "+a.body);i.unshift(new r(o,a.body))}else{if(a.type!==l)throw new SyntaxError("Unknown token: "+a.type);t.push(a)}return t}},{key:"_token",value:function(){if(!this.buf)return null;var t=this.buf.match(x);if(null===t){var e=new r(o,this.buf,this.pos);return this.pos+=this.buf.length,this.buf=null,e}var n=[];return 0!==t.index&&n.push(new r(o,this.buf.substring(0,t.index),this.pos)),n.push(new r(this._getNotTextType(t[0]),t[0],this.pos+t.index)),this.buf=this.buf.substring(t.index+t[0].length),this.pos+=t.index+t[0].length,0===this.buf.length&&(this.buf=null),n}},{key:"_getNotTextType",value:function(t){return"/"===t[1]?h:"/"===t[t.length-2]?l:u}}]),t}();e.default=E,Object.assign(E,{TEXT:o,OPEN:u,CLOSE:h,SELF_CLOSING:l,rxEnclosure:x,rxOpen:k,rxClose:v,rxSelfclosing:g})}])});
//# sourceMappingURL=shortcode-tokenizer.min.js.map
